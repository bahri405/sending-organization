<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Manajemen Peserta Pelatihan</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
            color: #333;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            transition: transform 0.3s ease;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }

        .sidebar.hidden {
            transform: translateX(-100%);
        }

        .sidebar-header {
            padding: 20px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }

        .sidebar-header h2 {
            font-size: 20px;
            font-weight: 600;
        }

        .menu-item {
            padding: 12px 15px;
            margin: 8px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .menu-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .menu-item.active {
            background: rgba(255,255,255,0.2);
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 260px;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        /* Header */
        .header {
            background: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .toggle-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }

        .toggle-btn:hover {
            background: #5568d3;
        }

        /* Content Area */
        .content {
            padding: 30px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Cards */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-card .number {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
        }

        /* Table */
        .table-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow-x: auto;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-box {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            width: 300px;
            font-size: 14px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
            margin: 0 3px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #666;
        }

        tr:hover {
            background: #f8f9fa;
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-info {
            background: #dbeafe;
            color: #1e40af;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #667eea;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .close-btn:hover {
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.show-mobile {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .search-box {
                width: 100%;
            }

            .stats-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>üìö Sistem Manajemen</h2>
                <p style="font-size: 12px; opacity: 0.8; margin-top: 5px;">Pelatihan & Keberangkatan</p>
            </div>
            <div class="menu-item active" onclick="navigateTo('dashboard')">
                üìä Dashboard
            </div>
            <div class="menu-item" onclick="navigateTo('peserta')">
                üë• Manajemen Peserta
            </div>
            <div class="menu-item" onclick="navigateTo('sending')">
                ‚úàÔ∏è Sending Organisation
            </div>
            <div class="menu-item" onclick="navigateTo('laporan')">
                üìà Laporan
            </div>
            <div class="menu-item" onclick="navigateTo('laporanEndToEnd')">
                üìã Laporan End-to-End
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Header -->
            <div class="header">
                <button class="toggle-btn" onclick="toggleSidebar()">‚ò∞ Menu</button>
                <h1 style="font-size: 20px; color: #667eea;">Sistem Manajemen Peserta Pelatihan</h1>
            </div>

            <!-- Content -->
            <div class="content">
                <!-- Dashboard Page -->
                <div class="page active" id="dashboard">
                    <h2 style="margin-bottom: 20px;">Dashboard</h2>
                    <div class="stats-container">
                        <div class="stat-card">
                            <h3>Total Peserta</h3>
                            <div class="number" id="totalPeserta">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Peserta Lolos</h3>
                            <div class="number" id="pesertaLolos">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Sudah Berangkat</h3>
                            <div class="number" id="sudahBerangkat">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Dalam Proses</h3>
                            <div class="number" id="dalamProses">0</div>
                        </div>
                    </div>

                    <div class="table-container">
                        <h3 style="margin-bottom: 15px;">Ringkasan per Batch</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Batch</th>
                                    <th>Total Peserta</th>
                                    <th>Lolos Seleksi</th>
                                    <th>Sudah Berangkat</th>
                                </tr>
                            </thead>
                            <tbody id="batchSummary">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Peserta Page -->
                <div class="page" id="peserta">
                    <h2 style="margin-bottom: 20px;">Manajemen Peserta</h2>
                    <div class="table-container">
                        <div class="table-header">
                            <input type="text" class="search-box" id="searchPeserta" placeholder="üîç Cari peserta..." onkeyup="searchTable('pesertaTable', 'searchPeserta')">
                            <button class="btn btn-primary" onclick="openModal('pesertaModal')">+ Tambah Peserta</button>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Nama</th>
                                    <th>Asal LPK</th>
                                    <th>Status Seleksi</th>
                                    <th>Pelatihan</th>
                                    <th>Nilai</th>
                                    <th>Interview</th>
                                    <th>Hasil</th>
                                    <th>Batch</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="pesertaTable">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Sending Organisation Page -->
                <div class="page" id="sending">
                    <h2 style="margin-bottom: 20px;">Sending Organisation</h2>
                    <div class="table-container">
                        <div class="table-header">
                            <input type="text" class="search-box" id="searchSending" placeholder="üîç Cari data keberangkatan..." onkeyup="searchTable('sendingTable', 'searchSending')">
                            <button class="btn btn-primary" onclick="openModal('sendingModal')">+ Tambah Data Keberangkatan</button>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Nama Peserta</th>
                                    <th>Job</th>
                                    <th>Lokasi</th>
                                    <th>Interview</th>
                                    <th>TTD Kontrak</th>
                                    <th>Dokumen</th>
                                    <th>Ijin Tinggal</th>
                                    <th>Keberangkatan</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="sendingTable">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Laporan Page -->
                <div class="page" id="laporan">
                    <h2 style="margin-bottom: 20px;">Laporan</h2>
                    
                    <div class="table-container" style="margin-bottom: 30px;">
                        <h3 style="margin-bottom: 15px;">Laporan per Batch</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Batch</th>
                                    <th>Total Peserta</th>
                                    <th>Lolos</th>
                                    <th>Tidak Lolos</th>
                                    <th>Berangkat</th>
                                    <th>Proses</th>
                                </tr>
                            </thead>
                            <tbody id="laporanBatch">
                            </tbody>
                        </table>
                    </div>

                    <div class="table-container">
                        <h3 style="margin-bottom: 15px;">Laporan per Pelatihan</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Jenis Pelatihan</th>
                                    <th>Total Peserta</th>
                                    <th>Lolos Seleksi</th>
                                    <th>Persentase</th>
                                </tr>
                            </thead>
                            <tbody id="laporanPelatihan">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Laporan End-to-End Page -->
                <div class="page" id="laporanEndToEnd">
                    <h2 style="margin-bottom: 20px;">Laporan Peserta End-to-End</h2>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <input type="text" class="search-box" id="searchEndToEnd" placeholder="üîç Cari peserta..." onkeyup="searchTable('endToEndTable', 'searchEndToEnd')">
                            <button class="btn btn-success" onclick="exportEndToEnd()">üì• Export Data</button>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Nama Peserta</th>
                                    <th>Asal LPK</th>
                                    <th>Status Seleksi</th>
                                    <th>Pelatihan</th>
                                    <th>Nilai</th>
                                    <th>Interview (Kumiai/User)</th>
                                    <th>Hasil</th>
                                    <th>Batch</th>
                                </tr>
                            </thead>
                            <tbody id="endToEndTable">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Peserta -->
    <div class="modal" id="pesertaModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="pesertaModalTitle">Tambah Peserta Baru</h2>
                <button class="close-btn" onclick="closeModal('pesertaModal')">&times;</button>
            </div>
            <form id="pesertaForm" onsubmit="savePeserta(event)">
                <input type="hidden" id="pesertaId">
                <div class="form-group">
                    <label>Nama Lengkap</label>
                    <input type="text" id="nama" required>
                </div>
                <div class="form-group">
                    <label>Asal LPK</label>
                    <input type="text" id="lpk" required>
                </div>
                <div class="form-group">
                    <label>Status Seleksi</label>
                    <select id="statusSeleksi" required>
                        <option value="">Pilih Status</option>
                        <option value="Belum">Belum</option>
                        <option value="Proses">Proses</option>
                        <option value="Selesai">Selesai</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Jenis Pelatihan</label>
                    <select id="pelatihan" required>
                        <option value="">Pilih Pelatihan</option>
                        <option value="Keperawatan">Keperawatan</option>
                        <option value="Caregiver">Caregiver</option>
                        <option value="Perhotelan">Perhotelan</option>
                        <option value="Kuliner">Kuliner</option>
                        <option value="Teknisi">Teknisi</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Nilai (0-100)</label>
                    <input type="number" id="nilai" min="0" max="100" required>
                </div>
                <div class="form-group">
                    <label>Status Interview</label>
                    <select id="interview" required>
                        <option value="">Pilih Status</option>
                        <option value="Belum">Belum</option>
                        <option value="Terjadwal">Terjadwal</option>
                        <option value="Selesai">Selesai</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Hasil Akhir</label>
                    <select id="hasil" required>
                        <option value="">Pilih Hasil</option>
                        <option value="Lolos">Lolos</option>
                        <option value="Tidak Lolos">Tidak Lolos</option>
                        <option value="Pending">Pending</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Interview Kumiai</label>
                    <input type="text" id="interviewKumiai" placeholder="Contoh: Kumiai A">
                </div>
                <div class="form-group">
                    <label>Interview User</label>
                    <input type="text" id="interviewUser" placeholder="Contoh: User A">
                </div>
                <div class="form-group">
                    <label>Batch</label>
                    <input type="text" id="batch" placeholder="Contoh: B-2025-01" required>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" class="btn btn-danger" onclick="closeModal('pesertaModal')">Batal</button>
                    <button type="submit" class="btn btn-primary">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Sending Organisation -->
    <div class="modal" id="sendingModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="sendingModalTitle">Tambah Data Keberangkatan</h2>
                <button class="close-btn" onclick="closeModal('sendingModal')">&times;</button>
            </div>
            <form id="sendingForm" onsubmit="saveSending(event)">
                <input type="hidden" id="sendingId">
                <div class="form-group">
                    <label>Nama Peserta</label>
                    <select id="sendingNama" required>
                        <option value="">Pilih Peserta</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Tanggal Interview</label>
                    <input type="date" id="sendingInterview" required>
                </div>
                <div class="form-group">
                    <label>Tanggal TTD Kontrak</label>
                    <input type="date" id="sendingKontrak" required>
                </div>
                <div class="form-group">
                    <label>Dokumen</label>
                    <input type="date" id="sendingDokumen">
                    <!-- <select id="sendingDokumen" required>
                        <option value="">Pilih Status</option>
                        <option value="Lengkap">Lengkap</option>
                        <option value="Belum Lengkap">Belum Lengkap</option>
                    </select> -->
                </div>
                <div class="form-group">
                    <label>Ijin Tinggal</label>
                    <input type="date" id="sendingIjin">
                    <!-- <select id="sendingIjin" required>
                        <option value="">Pilih Status</option>
                        <option value="Sudah">Sudah</option>
                        <option value="Proses">Proses</option>
                        <option value="Belum">Belum</option>
                    </select> -->
                </div>
                <div class="form-group">
                    <label>Tanggal Keberangkatan</label>
                    <input type="date" id="sendingKeberangkatan">
                </div>
                <div class="form-group">
                    <label>Status Keberangkatan</label>
                    <select id="sendingStatus" required>
                        <option value="">Pilih Status</option>
                        <option value="Proses">Proses</option>
                        <option value="Berangkat">Berangkat</option>
                    </select>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" class="btn btn-danger" onclick="closeModal('sendingModal')">Batal</button>
                    <button type="submit" class="btn btn-primary">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Data Storage
        let pesertaData = [
            {id: 1, nama: "Andi", lpk: "LPK A", statusSeleksi: "Lolos", pelatihan: "Bahasa Jepang", nilai: 85, interview: "Selesai", hasil: "Lolos", batch: "B-2025-01", interviewKumiai: "Kumiai A", interviewUser: "User A"},
            {id: 2, nama: "Siti", lpk: "LPK B", statusSeleksi: "Lolos", pelatihan: "Caregiver", nilai: 90, interview: "Selesai", hasil: "Lolos", batch: "B-2025-02", interviewKumiai: "Kumiai B", interviewUser: "User B"},
            {id: 3, nama: "Budi", lpk: "LPK C", statusSeleksi: "Lolos", pelatihan: "Bahasa Jepang", nilai: 70, interview: "Selesai", hasil: "Gagal", batch: "B-2025-01", interviewKumiai: "Kumiai A", interviewUser: "User A"},
            {id: 4, nama: "Dewi Lestari", lpk: "LPK BIMA", statusSeleksi: "Selesai", pelatihan: "Kuliner", nilai: 88, interview: "Selesai", hasil: "Lolos", batch: "B-2025-03", interviewKumiai: "Kumiai C", interviewUser: "User C"},
            {id: 5, nama: "Eko Prasetyo", lpk: "LPK BIMA", statusSeleksi: "Selesai", pelatihan: "Teknisi", nilai: 65, interview: "Selesai", hasil: "Tidak Lolos", batch: "B-2025-02", interviewKumiai: "Kumiai B", interviewUser: "User B"},
            {id: 6, nama: "Fitri Handayani", lpk: "LPK BIMA", statusSeleksi: "Belum", pelatihan: "Keperawatan", nilai: 0, interview: "Belum", hasil: "Pending", batch: "B-2025-03", interviewKumiai: "-", interviewUser: "-"},
            {id: 7, nama: "Gunawan Susilo", lpk: "LPK BIMA", statusSeleksi: "Selesai", pelatihan: "Caregiver", nilai: 92, interview: "Selesai", hasil: "Lolos", batch: "B-2025-01", interviewKumiai: "Kumiai A", interviewUser: "User A"},
            {id: 8, nama: "Hani Puspita", lpk: "LPK BIMA", statusSeleksi: "Proses", pelatihan: "Perhotelan", nilai: 78, interview: "Terjadwal", hasil: "Pending", batch: "B-2025-02", interviewKumiai: "-", interviewUser: "-"}
        ];

        let sendingData = [
            {id: 1, nama: "Andi", job: "welder", lokasi: "tokyo", interview: "2024-01-15", kontrak: "2024-02-01", dokumen: "Lengkap 2026-01-20", ijin: "Sudah 2026-01-20", keberangkatan: "2024-03-15", status: "Berangkat"},
            {id: 2, nama: "Siti", job: "welder", lokasi: "osaka", interview: "2024-01-15", kontrak: "2024-02-01", dokumen: "Lengkap 2026-01-13", ijin: "Sudah 2026-01-13", keberangkatan: "2024-03-15", status: "Berangkat"},
            {id: 3, nama: "Dewi Lestari", job: "caregiver", lokasi: "osaka", interview: "2024-02-10", kontrak: "2024-02-25", dokumen: "Belum Lengkap 2026-02-10", ijin: "Proses 2026-02-10", keberangkatan: "", status: "Proses"},
            {id: 4, nama: "Gunawan Susilo", job: "caregiver", lokasi: "tokyo", interview: "2024-02-10", kontrak: "2024-02-25", dokumen: "Belum Lengkap 2026-01-10", ijin: "Belum 2026-01-10", keberangkatan: "", status: "Proses"}
        ];

        let nextPesertaId = 9;
        let nextSendingId = 5;

        // Navigation
        function navigateTo(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            document.getElementById(page).classList.add('active');
            event.target.classList.add('active');
            
            if (page === 'dashboard') updateDashboard();
            if (page === 'peserta') renderPesertaTable();
            if (page === 'sending') renderSendingTable();
            if (page === 'laporan') updateLaporan();
            if (page === 'laporanEndToEnd') renderEndToEndTable();
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            sidebar.classList.toggle('hidden');
            mainContent.classList.toggle('expanded');
        }

        // Modal Functions
        function openModal(modalId) {
            if (modalId === 'sendingModal') {
                populatePesertaDropdown();
            }
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            if (modalId === 'pesertaModal') {
                document.getElementById('pesertaForm').reset();
                document.getElementById('pesertaId').value = '';
                document.getElementById('pesertaModalTitle').textContent = 'Tambah Peserta Baru';
            } else if (modalId === 'sendingModal') {
                document.getElementById('sendingForm').reset();
                document.getElementById('sendingId').value = '';
                document.getElementById('sendingModalTitle').textContent = 'Tambah Data Keberangkatan';
            }
        }

        // Search Function
        function searchTable(tableId, searchId) {
            const input = document.getElementById(searchId);
            const filter = input.value.toUpperCase();
            const table = document.getElementById(tableId);
            const tr = table.getElementsByTagName('tr');

            for (let i = 0; i < tr.length; i++) {
                let found = false;
                const td = tr[i].getElementsByTagName('td');
                for (let j = 0; j < td.length; j++) {
                    if (td[j]) {
                        const txtValue = td[j].textContent || td[j].innerText;
                        if (txtValue.toUpperCase().indexOf(filter) > -1) {
                            found = true;
                            break;
                        }
                    }
                }
                tr[i].style.display = found ? '' : 'none';
            }
        }

        // Dashboard Functions
        function updateDashboard() {
            const totalPeserta = pesertaData.length;
            const pesertaLolos = pesertaData.filter(p => p.hasil === 'Lolos').length;
            const sudahBerangkat = sendingData.filter(s => s.status === 'Berangkat').length;
            const dalamProses = sendingData.filter(s => s.status === 'Proses').length;

            document.getElementById('totalPeserta').textContent = totalPeserta;
            document.getElementById('pesertaLolos').textContent = pesertaLolos;
            document.getElementById('sudahBerangkat').textContent = sudahBerangkat;
            document.getElementById('dalamProses').textContent = dalamProses;

            // Batch Summary
            const batches = {};
            pesertaData.forEach(p => {
                if (!batches[p.batch]) {
                    batches[p.batch] = {total: 0, lolos: 0};
                }
                batches[p.batch].total++;
                if (p.hasil === 'Lolos') batches[p.batch].lolos++;
            });

            let batchHtml = '';
            Object.keys(batches).forEach(batch => {
                const berangkat = sendingData.filter(s => {
                    const peserta = pesertaData.find(p => p.nama === s.nama && p.batch === batch);
                    return peserta && s.status === 'Berangkat';
                }).length;
                
                batchHtml += `
                    <tr>
                        <td>${batch}</td>
                        <td>${batches[batch].total}</td>
                        <td>${batches[batch].lolos}</td>
                        <td>${berangkat}</td>
                    </tr>
                `;
            });
            document.getElementById('batchSummary').innerHTML = batchHtml;
        }

        // Peserta Functions
        function renderPesertaTable() {
            let html = '';
            pesertaData.forEach((p, index) => {
                const statusBadge = p.hasil === 'Lolos' ? 'badge-success' : 
                                   p.hasil === 'Tidak Lolos' ? 'badge-danger' : 'badge-warning';
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${p.nama}</td>
                        <td>${p.lpk}</td>
                        <td><span class="badge ${p.statusSeleksi === 'Selesai' ? 'badge-success' : 'badge-warning'}">${p.statusSeleksi}</span></td>
                        <td>${p.pelatihan}</td>
                        <td>${p.nilai}</td>
                        <td><span class="badge ${p.interview === 'Selesai' ? 'badge-success' : 'badge-info'}">${p.interview}</span></td>
                        <td><span class="badge ${statusBadge}">${p.hasil}</span></td>
                        <td>${p.batch}</td>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick="editPeserta(${p.id})">Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="deletePeserta(${p.id})">Hapus</button>
                        </td>
                    </tr>
                `;
            });
            document.getElementById('pesertaTable').innerHTML = html;
        }

        function savePeserta(event) {
            event.preventDefault();
            const id = document.getElementById('pesertaId').value;
            const peserta = {
                id: id ? parseInt(id) : nextPesertaId++,
                nama: document.getElementById('nama').value,
                lpk: document.getElementById('lpk').value,
                statusSeleksi: document.getElementById('statusSeleksi').value,
                pelatihan: document.getElementById('pelatihan').value,
                nilai: parseInt(document.getElementById('nilai').value),
                interview: document.getElementById('interview').value,
                hasil: document.getElementById('hasil').value,
                batch: document.getElementById('batch').value,
                interviewKumiai: document.getElementById('interviewKumiai').value || '-',
                interviewUser: document.getElementById('interviewUser').value || '-'
            };

            if (id) {
                const index = pesertaData.findIndex(p => p.id === parseInt(id));
                pesertaData[index] = peserta;
            } else {
                pesertaData.push(peserta);
            }

            closeModal('pesertaModal');
            renderPesertaTable();
            updateDashboard();
            renderEndToEndTable();
        }

        function editPeserta(id) {
            const peserta = pesertaData.find(p => p.id === id);
            document.getElementById('pesertaId').value = peserta.id;
            document.getElementById('nama').value = peserta.nama;
            document.getElementById('lpk').value = peserta.lpk;
            document.getElementById('statusSeleksi').value = peserta.statusSeleksi;
            document.getElementById('pelatihan').value = peserta.pelatihan;
            document.getElementById('nilai').value = peserta.nilai;
            document.getElementById('interview').value = peserta.interview;
            document.getElementById('hasil').value = peserta.hasil;
            document.getElementById('batch').value = peserta.batch;
            document.getElementById('interviewKumiai').value = peserta.interviewKumiai !== '-' ? peserta.interviewKumiai : '';
            document.getElementById('interviewUser').value = peserta.interviewUser !== '-' ? peserta.interviewUser : '';
            document.getElementById('pesertaModalTitle').textContent = 'Edit Data Peserta';
            openModal('pesertaModal');
        }

        function deletePeserta(id) {
            if (confirm('Apakah Anda yakin ingin menghapus data peserta ini?')) {
                pesertaData = pesertaData.filter(p => p.id !== id);
                renderPesertaTable();
                updateDashboard();
                renderEndToEndTable();
            }
        }

        // Sending Organisation Functions
        function populatePesertaDropdown() {
            const select = document.getElementById('sendingNama');
            const lolosPeserta = pesertaData.filter(p => p.hasil === 'Lolos');
            let options = '<option value="">Pilih Peserta</option>';
            lolosPeserta.forEach(p => {
                options += `<option value="${p.nama}">${p.nama} - ${p.batch}</option>`;
            });
            select.innerHTML = options;
        }

        function renderSendingTable() {
            let html = '';
            sendingData.forEach((s, index) => {
                const statusBadge = s.status === 'Berangkat' ? 'badge-success' : 'badge-warning';
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${s.nama}</td>
                        <td>${s.job}</td>
                        <td>${s.lokasi}</td>
                        <td>${s.interview}</td>
                        <td>${s.kontrak}</td>
                        <td><span class="badge ${s.dokumen === 'Lengkap' ? 'badge-success' : 'badge-warning'}">${s.dokumen}</span></td>
                        <td><span class="badge ${s.ijin === 'Sudah' ? 'badge-success' : 'badge-warning'}">${s.ijin}</span></td>
                        <td>${s.keberangkatan || '-'}</td>
                        <td><span class="badge ${statusBadge}">${s.status}</span></td>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick="editSending(${s.id})">Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteSending(${s.id})">Hapus</button>
                        </td>
                    </tr>
                `;
            });
            document.getElementById('sendingTable').innerHTML = html;
        }

        function saveSending(event) {
            event.preventDefault();
            const id = document.getElementById('sendingId').value;
            const sending = {
                id: id ? parseInt(id) : nextSendingId++,
                nama: document.getElementById('sendingNama').value,
                interview: document.getElementById('sendingInterview').value,
                kontrak: document.getElementById('sendingKontrak').value,
                dokumen: document.getElementById('sendingDokumen').value,
                ijin: document.getElementById('sendingIjin').value,
                keberangkatan: document.getElementById('sendingKeberangkatan').value,
                status: document.getElementById('sendingStatus').value
            };

            if (id) {
                const index = sendingData.findIndex(s => s.id === parseInt(id));
                sendingData[index] = sending;
            } else {
                sendingData.push(sending);
            }

            closeModal('sendingModal');
            renderSendingTable();
            updateDashboard();
        }

        function editSending(id) {
            const sending = sendingData.find(s => s.id === id);
            document.getElementById('sendingId').value = sending.id;
            document.getElementById('sendingNama').value = sending.nama;
            document.getElementById('sendingInterview').value = sending.interview;
            document.getElementById('sendingKontrak').value = sending.kontrak;
            document.getElementById('sendingDokumen').value = sending.dokumen;
            document.getElementById('sendingIjin').value = sending.ijin;
            document.getElementById('sendingKeberangkatan').value = sending.keberangkatan;
            document.getElementById('sendingStatus').value = sending.status;
            document.getElementById('sendingModalTitle').textContent = 'Edit Data Keberangkatan';
            populatePesertaDropdown();
            openModal('sendingModal');
        }

        function deleteSending(id) {
            if (confirm('Apakah Anda yakin ingin menghapus data keberangkatan ini?')) {
                sendingData = sendingData.filter(s => s.id !== id);
                renderSendingTable();
                updateDashboard();
            }
        }

        // Laporan Functions
        function updateLaporan() {
            // Laporan per Batch
            const batches = {};
            pesertaData.forEach(p => {
                if (!batches[p.batch]) {
                    batches[p.batch] = {total: 0, lolos: 0, tidakLolos: 0, berangkat: 0, proses: 0};
                }
                batches[p.batch].total++;
                if (p.hasil === 'Lolos') batches[p.batch].lolos++;
                if (p.hasil === 'Tidak Lolos') batches[p.batch].tidakLolos++;
            });

            sendingData.forEach(s => {
                const peserta = pesertaData.find(p => p.nama === s.nama);
                if (peserta && batches[peserta.batch]) {
                    if (s.status === 'Berangkat') batches[peserta.batch].berangkat++;
                    if (s.status === 'Proses') batches[peserta.batch].proses++;
                }
            });

            let batchHtml = '';
            Object.keys(batches).forEach(batch => {
                batchHtml += `
                    <tr>
                        <td>${batch}</td>
                        <td>${batches[batch].total}</td>
                        <td>${batches[batch].lolos}</td>
                        <td>${batches[batch].tidakLolos}</td>
                        <td>${batches[batch].berangkat}</td>
                        <td>${batches[batch].proses}</td>
                    </tr>
                `;
            });
            document.getElementById('laporanBatch').innerHTML = batchHtml;

            // Laporan per Pelatihan
            const pelatihan = {};
            pesertaData.forEach(p => {
                if (!pelatihan[p.pelatihan]) {
                    pelatihan[p.pelatihan] = {total: 0, lolos: 0};
                }
                pelatihan[p.pelatihan].total++;
                if (p.hasil === 'Lolos') pelatihan[p.pelatihan].lolos++;
            });

            let pelatihanHtml = '';
            Object.keys(pelatihan).forEach(jenis => {
                const persentase = ((pelatihan[jenis].lolos / pelatihan[jenis].total) * 100).toFixed(1);
                pelatihanHtml += `
                    <tr>
                        <td>${jenis}</td>
                        <td>${pelatihan[jenis].total}</td>
                        <td>${pelatihan[jenis].lolos}</td>
                        <td><span class="badge badge-info">${persentase}%</span></td>
                    </tr>
                `;
            });
            document.getElementById('laporanPelatihan').innerHTML = pelatihanHtml;
        }

        // Laporan End-to-End Functions
        function renderEndToEndTable() {
            let html = '';
            pesertaData.forEach(p => {
                const statusBadge = p.hasil === 'Lolos' ? 'badge-success' : 
                                   p.hasil === 'Gagal' || p.hasil === 'Tidak Lolos' ? 'badge-danger' : 'badge-warning';
                const interviewInfo = p.interviewKumiai !== '-' ? `${p.interviewKumiai} / ${p.interviewUser}` : '-';
                
                html += `
                    <tr>
                        <td>${p.nama}</td>
                        <td>${p.lpk}</td>
                        <td><span class="badge ${p.statusSeleksi === 'Lolos' ? 'badge-success' : 'badge-warning'}">${p.statusSeleksi}</span></td>
                        <td>${p.pelatihan}</td>
                        <td>${p.nilai}</td>
                        <td>${interviewInfo}</td>
                        <td><span class="badge ${statusBadge}">${p.hasil}</span></td>
                        <td>${p.batch}</td>
                    </tr>
                `;
            });
            document.getElementById('endToEndTable').innerHTML = html;
        }

        function exportEndToEnd() {
            let csvContent = "Nama Peserta,Asal LPK,Status Seleksi,Pelatihan,Nilai,Interview Kumiai,Interview User,Hasil,Batch\n";
            
            pesertaData.forEach(p => {
                csvContent += `${p.nama},${p.lpk},${p.statusSeleksi},${p.pelatihan},${p.nilai},${p.interviewKumiai},${p.interviewUser},${p.hasil},${p.batch}\n`;
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            
            link.setAttribute("href", url);
            link.setAttribute("download", "laporan_end_to_end.csv");
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Initialize
        window.onload = function() {
            updateDashboard();
            renderPesertaTable();
            renderSendingTable();
            updateLaporan();
            renderEndToEndTable();
        };
    </script>
</body>
</html>